<div style="padding: 16px">
  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px">
    <h2 style="margin: 0">Chat</h2>
    <span style="opacity: 0.6">{{ conversationId$ | async }}</span>
  </div>

  <div class="messages">
    @for(m of messages$ | async; track $index) { <app-message-item [message]="m"
    (contextmenu)="openChatMenu($event, m.id)/> }

    <div class="reasoning" (click)="toggleReasoning()" [class.open]="reasoningOpen">
      @for(part of draftReasoning$ | async; track $index) {
      <div class="part">{{ part }}</div>
      }
    </div>

    <!-- Live stream draft (wÃ¤hrend isStreaming) -->
    @if(isStreaming$ | async) {
    <ng-container>
      <app-message-item [message]="{ role: 'assistant', content: (draft$ | async) || '' }" />
    </ng-container>
    }
  </div>

  <app-composer></app-composer>

  @if (menu().open) {
  <app-context-menu
    [position]="menu().pos"
    [context]="menu().chatId"
    [items]="assistentMenuItems"
    (close)="closeMenu()"
  />
  }

  <div *ngIf="error$ | async as err" style="margin-top: 10px; color: #b00020">Error: {{ err }}</div>
</div>
